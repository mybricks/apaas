(()=>{var __webpack_modules__={125:(n,e,t)=>{"use strict";var r,o,i,a,c,u,l;t.d(e,{$_:()=>l,Ks:()=>r,Tf:()=>o,fu:()=>a}),function(n){n.STRING="string",n.NUMBER="number",n.DATETIME="datetime",n.JSON="json",n.ENUM="enum",n.RELATION="relation",n.MAPPING="mapping",n.SYS_USER="SYS_USER",n.SYS_ROLE="SYS_ROLE",n.SYS_ROLE_RELATION="SYS_ROLE_RELATION",n.CALC="calc"}(r||(r={})),function(n){n.VARCHAR="varchar",n.BIGINT="bigint",n.MEDIUMTEXT="mediumtext"}(o||(o={})),function(n){n.AND="AND",n.OR="OR"}(i||(i={})),function(n){n.EQUAL="=",n.NOT_EQUAL="<>",n.LIKE="LIKE",n.NOT_LIKE="NOT LIKE",n.IN="IN",n.NOT_IN="NOT IN",n.GE=">=",n.LE="<=",n.IS_NULL="IS NULL",n.IS_NOT_NULL="IS NOT NULL"}(a||(a={})),function(n){n.ASC="ASC",n.DESC="DESC"}(c||(c={})),function(n){n.ENUM="ENUM",n.CUSTOM="CUSTOM"}(u||(u={})),function(n){n.CURRENT_TIME="$currentTime"}(l||(l={}))},755:(n,e,t)=>{"use strict";function r(n){var e=n.env,t=n.inputs,r=n.data;t.customResponse((function(n){var t,o;e.collect("结束 response: ",n),null===(o=null===(t=e.hooks)||void 0===t?void 0:t.onFinished)||void 0===o||o.call(t,n,!r.useRegular)}))}t.d(e,{A:()=>r})},571:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _util__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(983),__assign=function(){return __assign=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},__assign.apply(this,arguments)};function __WEBPACK_DEFAULT_EXPORT__(_a){var _b,_c,env=_a.env,data=_a.data,inputs=_a.inputs,outputs=_a.outputs,onError=_a.onError,fns=data.fns,runImmediate=data.runImmediate,isDebug=null===(_b=env.runtime)||void 0===_b?void 0:_b.debug,runJSParams={outputs:(0,_util__WEBPACK_IMPORTED_MODULE_0__.K)(outputs),env:__assign(__assign({},env),{executeSql:function(n){return env.executeSql(n)},getEntityName:isDebug?function(n){return n}:env.getEntityName})};try{runImmediate&&env.runtime&&eval(decodeURIComponent(fns.transformCode||fns))(runJSParams),inputs.input((function(val){var _a;env.collect("执行 JS计算: ",val);try{eval(decodeURIComponent(fns.transformCode||fns))(__assign(__assign({},runJSParams),{inputs:(0,_util__WEBPACK_IMPORTED_MODULE_0__.K)(val)})),env.collect("执行 JS计算 结束: ",val)}catch(n){null==onError||onError(n.message),env.edit?console.error("js计算组件运行错误.",n):null===(_a=env.logger)||void 0===_a||_a.error("".concat(n))}}))}catch(n){null==onError||onError(n.message),env.edit?console.error("js计算组件运行错误.",n):null===(_c=env.logger)||void 0===_c||_c.error("".concat(n))}}},983:(n,e,t)=>{"use strict";function r(n){var e=[];return Object.keys(n).sort((function(n,e){var t,r;return+((null===(t=null==n?void 0:n.match(/\d+/g))||void 0===t?void 0:t[0])||0)-+((null===(r=null==e?void 0:e.match(/\d+/g))||void 0===r?void 0:r[0])||0)})).forEach((function(t){e.push(n[t])})),e}t.d(e,{K:()=>r})},728:(n,e,t)=>{"use strict";t.d(e,{A:()=>u});var r={HEADERS:"headers"},o=2,i=3,a=function(){return a=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},a.apply(this,arguments)};function c(n,e,t){var o=n.env,i=n.data,c=n.outputs;n.logger,void 0===e&&(e={}),void 0===t&&(t={});var u=i.connector,l=i.dynamicConfig;if(u||l)try{var s=u,d={openMock:i.globalMock||i.mock,outputSchema:i.outputSchema,mockOutputId:i.mockOutputId};l&&(s=l,d={openMock:l.globalMock||i.mock,outputSchema:l.outputSchema,mockOutputId:l.mockOutputId}),o.callConnector(s,e,a(a(a({},d),t),{onResponseInterception:function(n){var e;null===(e=c[r.HEADERS])||void 0===e||e.call(c,n.headers||{})},isMultipleOutputs:!0})).then((function(n){var e,t;c[null!==(e=null==n?void 0:n.__OUTPUT_ID__)&&void 0!==e?e:"then"](null!==(t=null==n?void 0:n.__ORIGIN_RESPONSE__)&&void 0!==t?t:n)})).catch((function(n){c.catch(n)}))}catch(n){console.error(n),c.catch("执行错误 ".concat(n.message||n))}else c.catch("没有选择接口")}function u(n){var e=n.env,t=n.data,r=n.inputs,a=n.outputs,u=n.logger;e.runtime&&(t.immediate?c({env:e,data:t,outputs:a,logger:u}):r.call((function(n){t.callReady|=t.useExternalUrl?o:i,function(n){var e=n.env,t=n.data,r=n.outputs,a=n.params,u=n.logger;t.callReady===i&&(t.callReady=o,c({env:e,data:t,outputs:r,logger:u},a,t.connectorConfig))}({env:e,data:t,logger:u,params:"object"==typeof n?n:{},outputs:a})})))}},528:(n,e,t)=>{"use strict";t.d(e,{D:()=>a,t:()=>i});var r=t(313),o=t(305),i=function(n){var e=n.conditions,t=n.params,a=n.whereJoiner,c=n.entityMap,u=n.curEntity,l=e.filter((function(n){return n.fieldId})),s=[];l.forEach((function(n){var e,a,l="";if(n.conditions)l=i({conditions:n.conditions,whereJoiner:n.whereJoiner,params:t,entityMap:c,curEntity:u});else{var d=c[n.entityId],f=null==d?void 0:d.fieldAry.find((function(e){return e.id===n.fieldId}));if(f){var p="".concat(f.name),m=n.value||"";if(d.id!==u.id){var v=u.fieldAry.find((function(e){var t,r;return(null===(r=null===(t=e.mapping)||void 0===t?void 0:t.entity)||void 0===r?void 0:r.id)===n.entityId})),_=null===(a=null===(e=null==v?void 0:v.mapping)||void 0===e?void 0:e.entity)||void 0===a?void 0:a.fieldAry.find((function(e){return e.id===n.fieldId}));p="MAPPING_".concat((null==v?void 0:v.name)||d.name)+((null==_?void 0:_.isPrimaryKey)?".MAPPING_".concat((null==v?void 0:v.name)||d.name,"_"):".")+((null==_?void 0:_.name)||f.name)}n.value.startsWith("{")&&n.value.endsWith("}")&&(m=(0,o.Jt)(t,n.value.substr(1,n.value.length-2).split(".").slice(1))),l="".concat(p," ").concat(n.operator," ").concat((0,r.ce)(f.dbType,n.operator,m))}}l&&s.push(l)}));var d="";return a||(d="WHERE "),d+"".concat(s.length>1?"(":"").concat(s.join(" ".concat(a," "))).concat(s.length>1?")":"")},a=function(n){var e=n.conditions,t=n.entities,r=n.params,o=(n.isEdit,{});t.forEach((function(n){return o[n.id]=n}));var a=t.find((function(n){return n.selected}));if(a){var c=[];return c.push("DELETE FROM ".concat(a.id)),c.push(i({conditions:[e],params:r,curEntity:a,entityMap:o})),c.join(" ")}}},313:(n,e,t)=>{"use strict";t.d(e,{ce:()=>u,y2:()=>l});var r=t(125),o={string:["varchar","char","text","mediumtext"],number:["int","bigint"]},i=function(n){return o.string.find((function(e){return e===n||n.includes(e)}))},a=function(n){return o.number.find((function(e){return e===n||n.includes(e)}))},c=function(n,e){return i(n)?"'".concat(e,"'"):(a(n),e)},u=function(n,e,t){return[r.fu.LIKE,r.fu.NOT_LIKE].includes(e)?"'%".concat(t,"%'"):[r.fu.IN,r.fu.NOT_IN].includes(e)?"(".concat((Array.isArray(t)?t:String(t).split(",")).map((function(e){return c(n,e)})).join(","),")"):[r.fu.IS_NOT_NULL,r.fu.IS_NULL].includes(e)?"":c(n,t)},l=function(n){return i(n)?"'":(a(n),"")}},614:(n,e,t)=>{"use strict";t.d(e,{w:()=>a});var r=t(305),o=function(n,e,t){if(t||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},i=function(n,e){if(null==n)return"";var t=function(n){return n<10?"0"+n:n},r=n.getFullYear(),o=r.toString().substring(2),i=n.getMonth()+1,a=t(i),c=n.getDate(),u=t(c),l=n.getHours(),s=t(l),d=n.getMinutes(),f=t(d),p=n.getSeconds(),m=t(p);return e.replace(/yyyy/g,r).replace(/yy/g,o).replace(/MM/g,a).replace(/M/g,i).replace(/DD/g,u).replace(/D/g,c).replace(/HH/g,s).replace(/H/g,l).replace(/mm/g,f).replace(/m/g,d).replace(/ss/g,m).replace(/s/g,p)},a=function(n,e,t){var a={};e.forEach((function(n){return a[n.id]=n}));var c=[];n.forEach((function(n){var t=e.find((function(e){return e.id===n.entityId}));if(t){var r=t.fieldAry.find((function(e){return e.id===n.fieldId}));if(r){var i="datetime"===r.bizType?r.showFormat:["enum","json"].includes(r.bizType)?"JSON":void 0;i&&c.push(o(o([],n.fromPath.map((function(n){return{key:n.fieldName}})),!0),[{key:r.name,showFormat:i}],!1))}}}));var u=function(n,e){if(e.length&&n){var t=e[0].key;if(1!==e.length)Array.isArray(n)?n.forEach((function(n){u(n,e.slice(1))})):u(n[t],e.slice(1));else if(Array.isArray(n))n.forEach((function(n){if("JSON"===e[0].showFormat)try{n[t]=n[t]?(0,r.xL)(n[t],n[t]):n[t]}catch(n){}else n["_"+t]=n[t],n[t]=n[t]&&e[0].showFormat?i(new Date(n[t]),e[0].showFormat):null}));else if("JSON"===e[0].showFormat)try{n[t]=n[t]?(0,r.xL)(n[t],n[t]):n[t]}catch(n){}else n["_"+t]=n[t],n[t]=n[t]&&e[0].showFormat?i(new Date(n[t]),e[0].showFormat):null}};return Array.from(t||[]).map((function(n){return c.forEach((function(e){u(n,e)})),n}))}},282:(n,e,t)=>{"use strict";t.d(e,{O:()=>a,X:()=>c});var r=t(125),o=t(313),i=t(305),a=function(n){var e=n.entity,t=n.conAry,a=(n.isEdit,n.genUniqueId),c=n.encrypt,u=n.data,l=n.batch,s="INSERT INTO ".concat(e.id," "),d=[],f=e.fieldAry.filter((function(n){return n.bizType!==r.Ks.MAPPING})).filter((function(n){return!n.isPrimaryKey||"auto_increment"!==n.extra})).map((function(n){return n.name}));return(l?u:[u]).forEach((function(n){var u=[];e.fieldAry.forEach((function(e){if(e.bizType!==r.Ks.MAPPING){var l=t.find((function(n){return n.to==="/".concat(e.name)}));if(l){var s=l.from.split("/").filter(Boolean),d=(0,i.Jt)(n,s.map((function(n){return n}))),f=(0,o.y2)(e.dbType);null==d?u.push("null"):Array.isArray(d)||"[object Object]"===Object.prototype.toString.call(d)?u.push("".concat(f).concat(JSON.stringify(e.useEncrypt?c(d):d)).concat(f)):u.push("".concat(f).concat(e.useEncrypt?c(d):d).concat(f))}else e.isPrimaryKey?"auto_increment"!==e.extra&&u.push(String(a())):"_STATUS_DELETED"===e.name?u.push("0"):["_UPDATE_TIME","_CREATE_TIME"].includes(e.name)||e.bizType===r.Ks.DATETIME&&e.defaultValueWhenCreate===r.$_.CURRENT_TIME?u.push(String(Date.now())):void 0!==e.defaultValueWhenCreate&&null!==e.defaultValueWhenCreate?(f=(0,o.y2)(e.dbType),u.push("".concat(f).concat(e.useEncrypt?c(e.defaultValueWhenCreate):e.defaultValueWhenCreate).concat(f))):e.notNull?u.push("null"):u.push("default")}})),d.push(u)})),"".concat(s,"(").concat(f.join(","),") VALUES ").concat(d.map((function(n){return"(".concat(n.join(","),")")})).join(", "))},c=function(n,e,t,o){var a;void 0===o&&(o=!0);for(var c=Array.isArray(n)?n:[n],u=e.fieldAry.filter((function(n){return t.find((function(e){return e.to==="/".concat(n.name)}))})),l=0;l<c.length;l++)for(var s=c[l],d=function(n){var e=u[n],c=t.find((function(n){return n.to==="/".concat(e.name)}));if(!c)return"continue";var l=c.from.substring(c.from.indexOf("/")+1).split("/"),d=(0,i.Jt)(s,l);if(null==d){if(o&&e.notNull&&!e.defaultValueWhenCreate)throw new Error("请求参数字段 "+l.join(".")+" 不能为空");if(!o&&e.notNull&&null===d)throw new Error("请求参数字段 "+l.join(".")+" 不能为空");return"continue"}if((e.dbType===r.Tf.VARCHAR||e.dbType===r.Tf.MEDIUMTEXT)&&e.bizType!==r.Ks.ENUM&&e.bizType!==r.Ks.JSON&&"string"!=typeof d&&"number"!=typeof d)throw new Error("请求参数字段 "+l.join(".")+" 必须为字符串或数字类型");if(e.dbType===r.Tf.BIGINT&&"number"!=typeof d&&parseInt(d)!=d)throw new Error("请求参数字段 "+l.join(".")+" 必须为数字类型");if(e.bizType===r.Ks.ENUM){var f=null!==(a=e.enumValues)&&void 0!==a?a:[];if(f.length){var p=d;try{p=JSON.parse(p)}catch(n){}if(Array.isArray(p)){for(var m=0;m<p.length;m++)if(!f.includes(p[m]))throw new Error("请求参数字段 "+l.join(".")+" 中每一项必须为枚举值 "+f.join("/")+" 其中之一")}else if(!f.includes(String(p)))throw new Error("请求参数字段 "+l.join(".")+" 必须为枚举值 "+f.join("/")+" 其中之一")}}},f=0;f<u.length;f++)d(f)}},801:(n,e,t)=>{"use strict";t.d(e,{G:()=>u});var r=t(313),o=t(125),i=function(){return i=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},i.apply(this,arguments)},a=function(n,e,t){if(t||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},c=function(n){var e=n.conditions,t=n.entities,i=n.params,u=n.whereJoiner,l=n.entityMap,s=n.curEntity,d=n.entityFieldMap,f=e.filter((function(n){return n.fieldId})).filter((function(n){var e,r;if(n.conditions)return!0;if(!(null===(e=n.value)||void 0===e?void 0:e.startsWith("{"))||!(null===(r=n.value)||void 0===r?void 0:r.endsWith("}")))return!![o.fu.IS_NOT_NULL,o.fu.IS_NULL].includes(null==n?void 0:n.operator)||void 0!==(null==n?void 0:n.value);var a=n.value.substr(1,n.value.length-2);if(!new RegExp("^".concat(t.map((function(n){return n.name})).join("|"),"\\.")).test(a)){for(var c=a.split(".").slice(1),u=i,l=void 0,s=0;s<c.length;s++)if(u=u[c[s]],s===c.length-1)l=u;else if("object"!=typeof u||null===u)break;return"IN"===n.operator||"NOT IN"===n.operator?!(Array.isArray(l)&&!(null==l?void 0:l.length))&&void 0!==l&&""!==l:void 0!==l}return!0})),p=[];f.forEach((function(n){var e,o,u,f,m;if(n.conditions)m=c({conditions:n.conditions,entities:t,whereJoiner:n.whereJoiner,params:i,entityMap:l,curEntity:s,entityFieldMap:d});else{var v=d[n.entityId+n.fieldId],_=v.name;if(n.fromPath.length){var h=n.fromPath[n.fromPath.length-1],y=d[h.entityId+h.fieldId],g=(null===(o=null===(e=y.mapping)||void 0===e?void 0:e.condition)||void 0===o?void 0:o.startsWith("count("))&&(null===(f=null===(u=y.mapping)||void 0===u?void 0:u.condition)||void 0===f?void 0:f.endsWith(")"));_="MAPPING_".concat(a(a([],n.fromPath.map((function(n){return d[n.entityId+n.fieldId].name})),!0),[g?"总数":v.name],!1).join("_"))}var b=n.value||"",A=!1;if(n.value.startsWith("{")&&n.value.endsWith("}")){var I=n.value.substr(1,n.value.length-2);if(new RegExp("^".concat(t.map((function(n){return n.name})).join("|"),"\\.")).test(I))b=I,A=!0;else for(var E=I.split(".").slice(1),P=i,w=0;w<E.length;w++)if(P=P[E[w]],w===E.length-1)b=P;else if("object"!=typeof P||null===P){b=void 0;break}}m="".concat(_," ").concat(n.operator," ").concat(A?b:(0,r.ce)(v.dbType,n.operator,b))}m&&p.push(m)}));var m="".concat(p.length>1?"(":"").concat(p.join(" ".concat(u," "))).concat(p.length>1?")":""),v="";return!u&&m&&(v="WHERE "),v+m},u=function(n){var e=n.conditions,t=n.entities,r=n.params,u=n.limit,l=n.orders,s=void 0===l?[]:l,d=n.pageNum,f=n.fields,p=n.showPager,m=n.selectCount,v=(n.isEdit,t.find((function(n){return n.selected})));if(v&&v.fieldAry.length){var _={},h={};t.forEach((function(n){_[n.id]=n,n.fieldAry.forEach((function(e){var t,r,i;h[n.id+e.id]=e,n.isSystem&&!e.isPrivate&&(h[n.id+e.name]=e),(null===(i=null===(r=null===(t=e.mapping)||void 0===t?void 0:t.entity)||void 0===r?void 0:r.fieldAry)||void 0===i?void 0:i.length)&&e.mapping.entity.fieldAry.filter((function(n){return n.bizType===o.Ks.CALC})).forEach((function(n){return h[e.mapping.entity.id+n.id]=n}))}))}));var y=[],g=[],b=[],A=[v.id],I=[],E=function(n){n.forEach((function(n){n.conditions?E(n.conditions):n.fieldId&&(I.push(n),I.push.apply(I,n.fromPath.slice(1).map((function(e,t){return i(i({},e),{fromPath:n.fromPath.slice(0,t+1)})}))))}))};E([e]),s=s.map((function(n){var e,t;if(n.fieldId)return i(i({},n),{fromPath:n.fromPath||[]});if(n.fieldName){for(var r=String(n.fieldName).split("."),o=[],a=v,c=function(){if(!a)return{value:void 0};var n=r.shift(),i=a.fieldAry.find((function(e){return e.name===n}));if(!i)return{value:void 0};o.push({fieldId:i.id,entityId:a.id,fieldName:i.name,fromPath:[]}),a=_[null===(t=null===(e=i.mapping)||void 0===e?void 0:e.entity)||void 0===t?void 0:t.id]};r.length;){var u=c();if("object"==typeof u)return u.value}if(o.length)return i(i({},o.pop()),{order:n.order,fromPath:o})}})).filter(Boolean).reduce((function(n,e){return a(a(a([],n,!0),[e],!1),e.fromPath.slice(1).map((function(n,t){return i(i({},n),{fromPath:e.fromPath.slice(0,t+1)})})),!0)}),[]);var P=a(a(a([],f,!0),s,!0),I,!0).reduce((function(n,e){var t=h[e.entityId+e.fieldId],r=e.fromPath.slice(0,-1);return t.bizType===o.Ks.CALC?(!t.hasHandle&&r.length&&(t.hasHandle=!0,t.sql=t.sql.replace(/MAPPING_/g,"MAPPING_".concat(r.map((function(n){return h[n.entityId+n.fieldId].name})),"_"))),a(a(a([],n,!0),[e],!1),(t.fields||[]).map((function(n){return i(i({},n),{fromCalcField:e,fromPath:a(a([],r,!0),n.fromPath,!0)})})),!0)):a(a([],n,!0),[e],!1)}),[]),w={};P.forEach((function(n){var e=a(a([],(n.fromPath||[]).map((function(n){return n.fieldId})),!0),[n.fieldId],!1).join(".");w[e]?w[e].fromCalcField&&!n.fromCalcField&&(w[e].fromCalcField=void 0):w[e]=n}));var S=(P=Object.values(w)).map((function(n){var e,t,r;return n.entityId!==v.id||(null===(e=n.fromPath)||void 0===e?void 0:e.length)?(null===(t=n.fromPath[0])||void 0===t?void 0:t.entityId)===v.id?null===(r=n.fromPath[0])||void 0===r?void 0:r.fieldId:void 0:n.fieldId})).filter(Boolean),O=function(n,e,t,r){var i=[];return n.forEach((function(n){var c,u,l,s;if(n){var d=P.filter((function(t){return t.fromPath.length===e&&t.fromPath[t.fromPath.length-1].fieldId===n.id}));if(d.length){var p=n.mapping.entity,m=String(n.mapping.condition),v=n.mapping.type,y=_[p.id],g=null;if("primary"===v?g=null!==(c=y.fieldAry.find((function(n){return n.isPrimaryKey})))&&void 0!==c?c:null:"foreigner"===v&&(g=null!==(u=y.fieldAry.find((function(n){return"relation"===n.bizType&&n.relationEntityId===r.id})))&&void 0!==u?u:null),g){var b=O(d.map((function(n){return h[n.entityId+n.fieldId]})),e+1,a(a([],t,!0),[n],!1),y),A=m.startsWith("max(")&&m.endsWith(")"),I="$$",E="";if("primary"===v){var w=r.fieldAry.find((function(e){return["relation","SYS_USER","SYS_ROLE","SYS_ROLE_RELATION"].includes(e.bizType)&&e.relationEntityId===y.id&&("mapping"===n.bizType||e.id===n.id)})),S=a(a([],t.map((function(n){return n.name})),!0),[n.name],!1).join("_"),N=[],T={};f.filter((function(t){return t.fromPath.find((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e}))})).forEach((function(t){var i=h[t.entityId+t.fieldId],a=t.fromPath.findIndex((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e}));if(t.fromPath.length-1===a){if(![o.Ks.MAPPING].includes(i.bizType)){var c=f.find((function(n){return n.fromPath.length===t.fromPath.length+1&&n.fromPath[n.fromPath.length-1].fieldId===i.id}));N.push("'".concat(c?"_":"").concat(i.name,"', ").concat(i.bizType===o.Ks.CALC?i.sql:i.name))}}else{var u=h[t.fromPath[a+1].entityId+t.fromPath[a+1].fieldId];T[u.name]||(N.push("'".concat(u.name,"', ").concat(u.name,"_JSON")),T[u.name]=1)}}));var k=P.filter((function(t){return(!t.fromCalcField||t.fromCalcField.fromPath.length<e)&&t.fromPath.find((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e}))&&(t.entityId!==y.id||!h[t.entityId+t.fieldId].isPrimaryKey)})).map((function(t){var i=h[t.entityId+t.fieldId],c=t.fromPath.findIndex((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e})),u="MAPPING_".concat(a(a([],t.fromPath.map((function(n){return h[n.entityId+n.fieldId].name})),!0),[i.isPrimaryKey&&"总数"===t.fieldName?t.fieldName:i.name],!1).join("_"));return t.fromPath.length-1!==c?u:[o.Ks.MAPPING].includes(i.bizType)?void 0:"".concat(i.bizType===o.Ks.CALC?i.sql:i.name," AS ").concat(u)})).filter(Boolean);E="LEFT JOIN (SELECT id AS MAPPING_".concat(S,"_id").concat(k.length?", ".concat(k.join(", ")):"").concat(N.length?", JSON_OBJECT(".concat(N.join(", "),") ").concat(n.name,"_JSON"):""," FROM ").concat(y.id," ").concat(b.join(" "),") MAPPING_").concat(S," ON MAPPING_").concat(S,".MAPPING_").concat(S,"_").concat(null!==(s=null===(l=null==w?void 0:w.relationField)||void 0===l?void 0:l.name)&&void 0!==s?s:"id"," = ").concat(r.id,".").concat(null==w?void 0:w.name)}else if("foreigner"===v){var R="MAPPING_"+[S=a(a([],t.map((function(n){return n.name})),!0),[n.name],!1).join("_"),null==g?void 0:g.name].join("_"),j=[],L={};if(f.filter((function(t){return t.fromPath.find((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e}))})).forEach((function(t){var i=h[t.entityId+t.fieldId],a=t.fromPath.findIndex((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e}));if(t.fromPath.length-1===a){var c=f.find((function(n){return n.fromPath.length===t.fromPath.length+1&&n.fromPath[n.fromPath.length-1].fieldId===i.id}));j.push("'".concat(c?"_":"").concat(i.name,"', ").concat(i.bizType===o.Ks.CALC?i.sql:i.name))}else{var u=h[t.fromPath[a+1].entityId+t.fromPath[a+1].fieldId];L[u.name]||(j.push("'".concat(u.name,"', ").concat(u.name,"_JSON")),L[u.name]=1)}})),"-1"===m)k=P.filter((function(t){var o=h[t.entityId+t.fieldId];return(!t.fromCalcField||t.fromCalcField.fromPath.length<e)&&t.fromPath.find((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e}))&&(t.entityId!==y.id||!o.isPrimaryKey)&&o.name!==(null==g?void 0:g.name)})).map((function(t){var i=t.fromPath.findIndex((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e})),c=h[t.entityId+t.fieldId],u="MAPPING_".concat(a(a([],t.fromPath.map((function(n){return h[n.entityId+n.fieldId].name})),!0),[c.name],!1).join("_"));return t.fromPath.length-1===i?"GROUP_CONCAT(".concat(c.bizType===o.Ks.CALC?c.sql:c.name,' SEPARATOR "').concat(I,'") ').concat(u):c.bizType!==o.Ks.MAPPING?"GROUP_CONCAT(".concat(u,' SEPARATOR "').concat(I,'") ').concat(u):void 0})).filter(Boolean),E='LEFT JOIN (SELECT GROUP_CONCAT(id SEPARATOR "'.concat(I,'") MAPPING_').concat(S,"_id, GROUP_CONCAT(").concat(null==g?void 0:g.name,' SEPARATOR "').concat(I,'") ').concat(R).concat(k.length?", ".concat(k.join(", ")):"").concat(j.length?", JSON_ARRAYAGG(JSON_OBJECT(".concat(j.join(", "),")) ").concat(n.name,"_JSON"):""," FROM ").concat(y.id," ").concat(b.join(" ")," WHERE GROUP BY ").concat(null==g?void 0:g.name,") MAPPING_").concat(S," ON MAPPING_").concat(S,".").concat(R," = ").concat(r.name,".id");else if(A){var C=m.substr(4,m.length-5);k=P.filter((function(t){var o=h[t.entityId+t.fieldId];return(!t.fromCalcField||t.fromCalcField.fromPath.length<e)&&t.fromPath.find((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e}))&&(t.entityId!==y.id||!o.isPrimaryKey)&&o.name!==(null==g?void 0:g.name)})).map((function(t){var i=t.fromPath.findIndex((function(t,o){return t.fieldId===n.id&&t.entityId===r.id&&o+1===e})),c=h[t.entityId+t.fieldId],u="MAPPING_".concat(a(a([],t.fromPath.map((function(n){return h[n.entityId+n.fieldId].name})),!0),[c.name],!1).join("_"));return t.fromPath.length-1===i?"".concat(c.bizType===o.Ks.CALC?c.sql:c.name," AS ").concat(u):c.bizType!==o.Ks.MAPPING?u:void 0})).filter(Boolean),E='LEFT JOIN (SELECT GROUP_CONCAT(id SEPARATOR "'.concat(I,'") MAPPING_').concat(S,"_id, GROUP_CONCAT(").concat(null==g?void 0:g.name,' SEPARATOR "').concat(I,'") ').concat(R).concat(k.length?", ".concat(k.join(", ")):"").concat(j.length?", JSON_ARRAYAGG(JSON_OBJECT(".concat(j.join(", "),")) ").concat(n.name,"_JSON"):""," FROM ").concat(y.id," ").concat(b.join(" ")," AND ").concat(C," IN (SELECT max(").concat(C,") FROM ").concat(y.id," GROUP BY ").concat(g.name,")) MAPPING_").concat(S," ON MAPPING_").concat(S,".").concat(R," = ").concat(r.id,".id")}else m.startsWith("count(")&&m.endsWith(")")&&(E="LEFT JOIN (SELECT ".concat(null==g?void 0:g.name," AS ").concat(R,", COUNT(id) AS MAPPING_").concat(S,"_总数, JSON_OBJECT('总数', COUNT(id)) ").concat(n.name,"_JSON FROM ").concat(y.id," ").concat(b.join(" ")," GROUP BY ").concat(null==g?void 0:g.name,") MAPPING_").concat(S," ON MAPPING_").concat(S,".").concat(R," = ").concat(r.id,".id"))}E&&i.push(E)}}}})),i};A.push.apply(A,O(v.fieldAry.filter((function(n){var e,t,r;return S.includes(n.id)&&(null===(r=null===(t=null===(e=n.mapping)||void 0===e?void 0:e.entity)||void 0===t?void 0:t.fieldAry)||void 0===r?void 0:r.length)&&_[n.mapping.entity.id]})),1,[],v));var N=[],T=f.map((function(n){var e=n;if(n.fromPath.length)e=n.fromPath[0];else if("mapping"===h[n.entityId+n.fieldId].bizType&&!f.find((function(e){var t;return(null===(t=e.fromPath[0])||void 0===t?void 0:t.fieldId)===n.fieldId})))return;return N.includes(e.fieldId)?void 0:(N.push(e.fieldId),e)})).filter(Boolean);T.map((function(n){var e=h[n.entityId+n.fieldId];"mapping"!==e.bizType?"relation"===e.bizType&&f.find((function(e){var t;return(null===(t=e.fromPath[0])||void 0===t?void 0:t.fieldId)===n.fieldId}))?b.push("".concat(e.name," AS _").concat(e.name),"".concat(e.name,"_JSON AS ").concat(e.name)):b.push(e.name):b.push("".concat(e.name,"_JSON AS ").concat(e.name))}));var k=c({conditions:[e],entities:t,params:r,entityMap:_,curEntity:v,entityFieldMap:h});if(console.log("whereSql: ",k),y.push("SELECT ".concat(b.join(", ")," FROM ").concat(A.join(" "))),y.push(k),(p||m)&&(g.push("SELECT count(*) as total FROM ".concat(A.join(" "))),g.push(k)),m)return["",g.join(" ")];if(s.length){var R=[];s.forEach((function(n){var e,t,r,o,i=h[n.entityId+n.fieldId];if(i)if(n.fromPath.length){var c=n.fromPath[n.fromPath.length-1],u=h[c.entityId+c.fieldId],l=(null===(t=null===(e=u.mapping)||void 0===e?void 0:e.condition)||void 0===t?void 0:t.startsWith("count("))&&(null===(o=null===(r=u.mapping)||void 0===r?void 0:r.condition)||void 0===o?void 0:o.endsWith(")"));R.push("MAPPING_".concat(a(a([],n.fromPath.map((function(n){return h[n.entityId+n.fieldId].name})),!0),[l?"总数":i.name],!1).join("_")," ").concat(n.order))}else R.push("".concat(i.name," ").concat(n.order))})),R.length&&y.push("ORDER BY ".concat(R.join(", ")))}var j=u.value?String(u.value):"";if(j&&(j.startsWith("{")&&j.endsWith("}")?(j=r[j.slice(j.indexOf(".")+1,-1)]||50)&&y.push("LIMIT ".concat(j)):y.push("LIMIT ".concat(j))),d)if(d.startsWith("{")&&d.endsWith("}")){var L=r[d.slice(d.indexOf(".")+1,-1)];L&&y.push("OFFSET ".concat((Number(L)-1)*Number(j)))}else Number.isNaN(Number(d))||y.push("OFFSET ".concat((Number(d)-1)*Number(j)));return[y.join(" "),g.join(" ")]}}},270:(n,e,t)=>{"use strict";t.d(e,{$:()=>a});var r=t(528),o=t(313),i=t(305),a=function(n){var e=n.conditions,t=n.entities,a=n.params,c=n.connectors,u=(n.isEdit,n.encrypt),l={};t.forEach((function(n){return l[n.id]=n}));var s=t.find((function(n){return n.selected}));if(s){var d=[];return d.push("UPDATE ".concat(s.id," SET")),d.push(function(n){var e=n.entity,t=n.params,r=n.encrypt;return n.connectors.map((function(n,a){var c=n.from,u=n.to.replace("/",""),l=e.fieldAry.find((function(n){return n.name===u}));if(l){var s=c.split("/").filter(Boolean),d=(0,i.Jt)(t,s),f="string"==typeof d?"'":(0,o.y2)(l.dbType);return void 0===d?"":"".concat(u," = ").concat(null===d?null:"".concat(f).concat(Array.isArray(d)||"[object Object]"===Object.prototype.toString.call(d)?JSON.stringify(l.useEncrypt?r(d):d):l.useEncrypt?r(d):d).concat(f))}})).filter(Boolean).reduce((function(n,e){return n?n+" , ".concat(e):n+e}),"")}({connectors:c,entity:s,params:a,encrypt:u})),d.push((0,r.t)({conditions:[e],params:a,curEntity:s,entityMap:l})),d.join(" ")}}},305:(n,e,t)=>{"use strict";t.d(e,{Jt:()=>o,xL:()=>r});var r=function(n,e){void 0===e&&(e={});try{return JSON.parse(n)}catch(n){return e}},o=function(n,e){void 0===e&&(e=[]);for(var t=n,r=function(n,e,t){if(t||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))}([],e,!0);void 0!==t&&r.length;)t=null==t?void 0:t[r.shift()];return t}},443:(n,e,t)=>{"use strict";function r(n){var e=n.data,t=n.outputs,r=n.inputs;r.get((function(n,t){var r=o(void 0!==e.val?e.val:e.initValue);t.return(r)})),r.set((function(n,r){e.val=n;var i=o(n);t.changed(i,!0)})),r.reset((function(){var n=e.initValue;e.val=n,t.changed(o(n),!0)}))}function o(n){if(n&&"object"==typeof n)try{return n instanceof FormData?n:JSON.parse(JSON.stringify(n))}catch(e){return n}return n}t.d(e,{A:()=>r})},462:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var __assign=function(){return __assign=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},__assign.apply(this,arguments)},getFnString=function(n,e){return"function _RT_ ({".concat(e.join(","),"}) {").concat(n,"}")};function __WEBPACK_DEFAULT_EXPORT__(_a){var _b,env=_a.env,data=_a.data,inputs=_a.inputs,outputs=_a.outputs,logger=_a.logger,onError=_a.onError,fns=data.fns,runImmediate=data.runImmediate,runJSParams={outputs};try{runImmediate&&env.runtime&&eval(decodeURIComponent(fns))(runJSParams),inputs.input0((function(val){var _a;try{eval(decodeURIComponent(fns))(__assign(__assign({},runJSParams),{inputValue:val}))}catch(n){null==onError||onError(n.message),env.edit?console.error("js计算组件运行错误.",n):null===(_a=env.logger)||void 0===_a||_a.error("".concat(n))}}))}catch(n){null==onError||onError(n.message),env.edit?console.error("js计算组件运行错误.",n):null===(_b=env.logger)||void 0===_b||_b.error("".concat(n))}}},760:(n,e,t)=>{"use strict";function r(n){var e=n.env,t=n.data,r=(n.outputs,n.inputs),o=n.onError;r.params((function(n,r){var i,a;e.collect("获取cookie key: ",t.keyName),t.keyName?null===(i=r.rtn)||void 0===i||i.call(r,null===(a=null==e?void 0:e.cookies)||void 0===a?void 0:a[t.keyName]):o("获取cookies 必须配置 key")}))}t.d(e,{A:()=>r})},332:(n,e,t)=>{"use strict";t.d(e,{A:()=>o});var r=function(){return r=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},r.apply(this,arguments)};function o(n){var e=n.env,t=n.data,o=(n.outputs,n.inputs),i=n.onError;o.params((function(n,o){var a;e.collect("设置cookies key: ",null==t?void 0:t.keyName),t.keyName?"string"!=typeof n&&"number"!=typeof n&&n?i("设置cookies 入参格式错误"):(null===(a=e.setCookie)||void 0===a||a.call(e,null==t?void 0:t.keyName,n,r(r({httpOnly:!!t.httpOnly,path:t.path||"/"},t.maxAge?{}:{maxAge:t.maxAge}),t.domain?{}:{domain:t.domain})),o.rtn(n)):i("设置cookies 必须配置 key")}))}},870:(n,e,t)=>{"use strict";t.d(e,{A:()=>o});var r=t(282);function o(n){var e=n.env,t=n.data,o=n.outputs,i=n.inputs,a=n.onError;i.params((function(n){var i,c=null===(i=e.runtime)||void 0===i?void 0:i.debug;if(t.rules)try{if(!n||!Array.isArray(n)||!n.length)throw new Error("输入数据错误，非数组或数字为空");(0,r.X)(n,t.rules.entities[0],t.rules.conAry),e.collect("批量插入数据 params: ",n);var u=(0,r.O)({entity:t.rules.entities[0],isEdit:c,data:n,batch:!0,conAry:t.rules.conAry,genUniqueId:e.genUniqueId,encrypt:e.encrypt});e.collect("批量插入数据 sql: ",u),e.executeSql(u).then((function(n){var t,r;e.collect("批量插入数据 res: ",n),o.rtn(n.insertId||(null===(r=null===(t=n.rows)||void 0===t?void 0:t[0])||void 0===r?void 0:r.insertId))})).catch((function(n){return a("执行SQL发生错误, ".concat(null==n?void 0:n.message))}))}catch(n){c&&console.error("执行SQL发生错误, ",n),a("执行错误, ".concat(null==n?void 0:n.message))}}))}},314:(n,e,t)=>{"use strict";t.d(e,{A:()=>c});var r=t(282),o=t(270),i=function(n,e,t,r){return new(t||(t=Promise))((function(o,i){function a(n){try{u(r.next(n))}catch(n){i(n)}}function c(n){try{u(r.throw(n))}catch(n){i(n)}}function u(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,c)}u((r=r.apply(n,e||[])).next())}))},a=function(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(n){c=[6,n],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};function c(n){var e=this,t=n.env,c=n.data,u=n.outputs,l=n.inputs,s=n.onError;l.params((function(n){return i(e,void 0,void 0,(function(){var e,i,l,d,f,p,m;return a(this,(function(a){switch(a.label){case 0:if(e=null===(m=t.runtime)||void 0===m?void 0:m.debug,!c.rules)return[3,7];a.label=1;case 1:if(a.trys.push([1,6,,7]),!n||!Array.isArray(n)||!n.length)throw new Error("输入数据错误，非数组或数字为空");(0,r.X)(n,c.rules.entities[0],c.rules.conAry,!1),t.collect("批量更新数据 params: ",n),i=0,l=n,a.label=2;case 2:return i<l.length?(d=l[i],f=(0,o.$)({conditions:c.rules.conditions,connectors:c.rules.conAry,entities:c.rules.entities,params:d,isEdit:e,encrypt:t.encrypt}),t.collect("批量更新数据 sql: ",f),[4,t.executeSql(f)]):[3,5];case 3:a.sent(),a.label=4;case 4:return i++,[3,2];case 5:return u.rtn(),[3,7];case 6:return p=a.sent(),e&&console.error("执行SQL发生错误, ",p),s("执行错误, ".concat(null==p?void 0:p.message)),[3,7];case 7:return[2]}}))}))}))}},670:(n,e,t)=>{"use strict";t.d(e,{A:()=>o});var r=t(528);function o(n){var e=n.env,t=n.data,o=n.outputs,i=n.inputs,a=n.onError;i.params((function(n){var i,c=null===(i=e.runtime)||void 0===i?void 0:i.debug;if(t.rules)try{e.collect("删除数据 val: ",n);var u=(0,r.D)({conditions:t.rules.conditions,entities:t.rules.entities,params:n,isEdit:c});e.collect("删除数据 sql: ",u),e.executeSql(u).then((function(){return o.rtn()})).catch((function(n){return a("执行SQL发生错误,".concat(null==n?void 0:n.message))}))}catch(n){c&&console.error("执行SQL发生错误, ",n),a("执行错误, ".concat(null==n?void 0:n.message))}}))}},624:(n,e,t)=>{"use strict";t.d(e,{A:()=>o});var r=t(282);function o(n){var e=n.env,t=n.data,o=n.outputs,i=n.inputs,a=n.onError;i.params((function(n){var i,c=null===(i=e.runtime)||void 0===i?void 0:i.debug;if(t.rules)try{(0,r.X)(n,t.rules.entities[0],t.rules.conAry),e.collect("添加数据 val: ",n);var u=(0,r.O)({entity:t.rules.entities[0],isEdit:c,data:n,batch:!1,conAry:t.rules.conAry,genUniqueId:e.genUniqueId,encrypt:e.encrypt});e.collect("添加数据 sql: ",u),e.executeSql(u).then((function(n){var t;e.collect("添加数据 res: ",n),o.rtn(n.insertId||(null===(t=n.rows)||void 0===t?void 0:t.insertId))})).catch((function(n){return a("执行SQL发生错误, ".concat(null==n?void 0:n.message))}))}catch(n){c&&console.error("执行SQL发生错误, ",n),a("执行错误, ".concat(null==n?void 0:n.message))}}))}},537:(n,e,t)=>{"use strict";t.d(e,{A:()=>u});var r=t(801),o=t(614),i=function(){return i=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},i.apply(this,arguments)},a=function(n,e,t,r){return new(t||(t=Promise))((function(o,i){function a(n){try{u(r.next(n))}catch(n){i(n)}}function c(n){try{u(r.throw(n))}catch(n){i(n)}}function u(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,c)}u((r=r.apply(n,e||[])).next())}))},c=function(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(n){c=[6,n],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};function u(n){var e,t=this,u=n.env,l=n.data,s=n.outputs,d=n.inputs,f=n.onError;if(l.selector){var p=null===(e=u.runtime)||void 0===e?void 0:e.debug,m={params:{},fields:l.selector.fields||[],conditions:l.selector.conditions||[],entities:l.selector.entities||[],limit:l.selector.limit,showPager:!1,selectCount:!1,orders:l.selector.orders,pageNum:l.selector.pageNum,isEdit:p},v=function(n){return a(t,void 0,void 0,(function(){var e,t,i;return c(this,(function(a){switch(a.label){case 0:return e=((0,r.G)(n)||[])[0],u.collect("查询数据 sql: ",e),[4,u.executeSql(e)];case 1:return t=a.sent(),u.collect("查询数据 res: ",t),i=t.rows,i=Array.from(i||[]),(0,o.w)(n.fields||[],n.entities,i),[2,i]}}))}))};l.autoRun&&v(m).then((function(n){return s.rtn(n)})).catch((function(n){p&&console.error("执行SQL发生错误, ",n),f("执行SQL发生错误, ".concat(null==n?void 0:n.message))})),d.params((function(n){v(i(i({},m),{params:n,orders:n.orders&&Array.isArray(n.orders)?n.orders:m.orders})).then((function(n){return s.rtn(n)})).catch((function(n){p&&console.error("执行SQL发生错误, ",n),f("执行SQL发生错误, ".concat(null==n?void 0:n.message))}))}))}}},251:(n,e,t)=>{"use strict";t.d(e,{A:()=>u});var r=t(801),o=t(614),i=function(){return i=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},i.apply(this,arguments)},a=function(n,e,t,r){return new(t||(t=Promise))((function(o,i){function a(n){try{u(r.next(n))}catch(n){i(n)}}function c(n){try{u(r.throw(n))}catch(n){i(n)}}function u(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,c)}u((r=r.apply(n,e||[])).next())}))},c=function(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(n){c=[6,n],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};function u(n){var e,t=this,u=n.env,l=n.data,s=n.outputs,d=n.inputs,f=n.onError;if(l.selector){var p=null===(e=u.runtime)||void 0===e?void 0:e.debug,m={params:{},fields:l.selector.fields||[],conditions:l.selector.conditions||[],entities:l.selector.entities||[],limit:l.selector.limit,showPager:!0,selectCount:!1,orders:l.selector.orders,pageNum:l.selector.pageNum,isEdit:p},v=function(n){return a(t,void 0,void 0,(function(){var e,t,i,a,l;return c(this,(function(c){switch(c.label){case 0:return u.collect("分页查询数据 params: ",n),e=(0,r.G)(n)||[],t=e[0],i=e[1],u.collect("分页查询数据 sql: ",{sql:t,countSql:i}),[4,u.executeSql(t)];case 1:return a=c.sent().rows,u.collect("分页查询数据 res: ",{rows:a}),a=Array.from(a||[]),(0,o.w)(n.fields||[],n.entities,a),[4,u.executeSql(i)];case 2:return l=c.sent().rows,u.collect("分页查询数据 res: ",{rows:l}),[2,{dataSource:a,total:l[0]?l[0].total:0,pageNum:n.params.pageNum||1,pageSize:n.params.pageSize||50}]}}))}))};l.autoRun?v(m).then((function(n){return s.rtn(n)})).catch((function(n){p&&console.error("执行SQL发生错误, ",n),f("执行SQL发生错误, ".concat(null==n?void 0:n.message))})):d.params((function(n){return a(t,void 0,void 0,(function(){var e,t,r;return c(this,(function(o){switch(o.label){case 0:e=i(i({},n.pageParams||{}),n.params||{}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,v(i(i({},m),{params:e,orders:e.orders&&Array.isArray(e.orders)?e.orders:m.orders}))];case 2:return t=o.sent(),s.rtn(t),[3,4];case 3:return r=o.sent(),p&&console.error("执行SQL发生错误, ",r),f("执行SQL发生错误, ".concat(null==r?void 0:r.message)),[3,4];case 4:return[2]}}))}))}))}}},88:(n,e,t)=>{"use strict";t.d(e,{A:()=>c});var r=t(801),o=function(){return o=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},o.apply(this,arguments)},i=function(n,e,t,r){return new(t||(t=Promise))((function(o,i){function a(n){try{u(r.next(n))}catch(n){i(n)}}function c(n){try{u(r.throw(n))}catch(n){i(n)}}function u(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,c)}u((r=r.apply(n,e||[])).next())}))},a=function(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(n){c=[6,n],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};function c(n){var e,t=this,c=n.env,u=n.data,l=n.outputs,s=n.inputs,d=n.onError;if(u.selector){var f=null===(e=c.runtime)||void 0===e?void 0:e.debug,p={params:{},fields:u.selector.fields||[],conditions:u.selector.conditions||[],entities:u.selector.entities||[],limit:u.selector.limit,showPager:!1,selectCount:!0,orders:u.selector.orders,pageNum:u.selector.pageNum,isEdit:f},m=function(n){return i(t,void 0,void 0,(function(){var e,t,o;return a(this,(function(i){switch(i.label){case 0:return c.collect("查询数据总数 params: ",n),e=(0,r.G)(n)||[],t=e[1],c.collect("查询数据总数 countSql: ",t),[4,c.executeSql(t)];case 1:return o=i.sent().rows,c.collect("查询数据总数 res: ",{rows:o}),[2,{total:o[0]?o[0].total:0}]}}))}))};u.autoRun&&m(p).then((function(n){return l.rtn(n)})).catch((function(n){f&&console.error("执行SQL发生错误, ",n),d("执行SQL发生错误, ".concat(null==n?void 0:n.message))})),s.params((function(n){m(o(o({},p),{params:n})).then((function(n){return l.rtn(n)})).catch((function(n){f&&console.error("执行SQL发生错误, ",n),d("执行SQL发生错误, ".concat(null==n?void 0:n.message))}))}))}}},737:(n,e,t)=>{"use strict";t.d(e,{A:()=>l});var r=t(801),o=t(614),i=function(){return i=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},i.apply(this,arguments)},a=function(n,e,t,r){return new(t||(t=Promise))((function(o,i){function a(n){try{u(r.next(n))}catch(n){i(n)}}function c(n){try{u(r.throw(n))}catch(n){i(n)}}function u(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,c)}u((r=r.apply(n,e||[])).next())}))},c=function(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(n){c=[6,n],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}},u=function(n){return null==n||Array.isArray(n)&&!n.length};function l(n){var e,t=this,l=n.env,s=n.data,d=n.outputs,f=n.inputs,p=n.onError;if(s.selector){var m=null===(e=l.runtime)||void 0===e?void 0:e.debug,v={params:{},fields:s.selector.fields||[],conditions:s.selector.conditions||[],entities:s.selector.entities||[],limit:s.selector.limit,showPager:!1,selectCount:!1,orders:s.selector.orders,pageNum:s.selector.pageNum,isEdit:m},_=function(n){return a(t,void 0,void 0,(function(){var e,t;return c(this,(function(i){switch(i.label){case 0:return l.collect("单条查询数据 params: ",n),e=((0,r.G)(n)||[])[0],l.collect("单条查询数据 sql: ",e),[4,l.executeSql(e)];case 1:return t=i.sent().rows,l.collect("单条查询数据 res: ",{rows:t}),t=Array.from(t||[]),(0,o.w)(n.fields||[],n.entities,t),[2,t]}}))}))};s.autoRun&&_(v).then((function(n){var e=null==n?void 0:n[0];d[s.emptyCheck&&u(e)?"empty":"rtn"](e)})).catch((function(n){m&&console.error("执行SQL发生错误, ",n),p("执行SQL发生错误, ".concat(null==n?void 0:n.message))})),f.params((function(n){_(i(i({},v),{params:n,orders:n.orders&&Array.isArray(n.orders)?n.orders:v.orders})).then((function(n){var e=null==n?void 0:n[0];d[s.emptyCheck&&u(e)?"empty":"rtn"](e)})).catch((function(n){m&&console.error("执行SQL发生错误, ",n),p("执行SQL发生错误, ".concat(null==n?void 0:n.message))}))}))}}},576:(n,e,t)=>{"use strict";t.d(e,{A:()=>i});var r=t(282),o=t(270);function i(n){var e=n.env,t=n.data,i=n.outputs,a=n.inputs,c=n.onError;a.params((function(n){var a,u=null===(a=e.runtime)||void 0===a?void 0:a.debug;if(t.rules)try{(0,r.X)(n,t.rules.entities[0],t.rules.conAry,!1),e.collect("更新数据 params: ",n);var l=(0,o.$)({conditions:t.rules.conditions,connectors:t.rules.conAry,entities:t.rules.entities,params:n,isEdit:u,encrypt:e.encrypt});e.collect("更新数据 sql: ",l),e.executeSql(l).then((function(){return i.rtn()})).catch((function(n){return c("执行SQL发生错误,".concat(null==n?void 0:n.message))}))}catch(n){u&&console.error("执行SQL发生错误, ",n),c("执行错误, ".concat(null==n?void 0:n.message))}}))}},564:(n,e,t)=>{"use strict";t.d(e,{A:()=>o});var r=function(){return r=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},r.apply(this,arguments)};function o(n){var e=n.env,t=n.inputs,o=n.data;t.inputValue((function(n,t){var i,a=null===(i=null==e?void 0:e.user)||void 0===i?void 0:i.id;t.rtn(o.merge&&"[object Object]"===Object.prototype.toString.call(n)?r(r({},n),{userId:a}):{userId:a})}))}},698:(n,e,t)=>{"use strict";function r(n){var e=n.env,t=n.data,r=(n.outputs,n.inputs),o=n.onError;r.params((function(n,r){var i;if(n)try{var a=e.jwt.sign(n,t.secretKey,{expiresIn:"".concat(t.expiresIn,"s")});r.rtn(a)}catch(n){o("生成token出错，".concat(null!==(i=null==n?void 0:n.message)&&void 0!==i?i:"未知错误"))}else o("生成token的参数不存在或者格式有误")}))}t.d(e,{A:()=>r})},74:(n,e,t)=>{"use strict";function r(n){var e=n.env,t=n.data,r=(n.outputs,n.inputs),o=n.onError;r.params((function(n,r){var i,a;if(n||"string"!=typeof n)try{var c=e.jwt.verify(n,t.secretKey);r.rtn(c)}catch(n){(null===(i=null==n?void 0:n.message)||void 0===i?void 0:i.indexOf("expired"))>-1?o("token已过期"):o("解析token出错，".concat(null!==(a=null==n?void 0:n.message)&&void 0!==a?a:"未知错误"))}else o("解析token的参数不存在或者格式有误")}))}t.d(e,{A:()=>r})},513:(n,e,t)=>{"use strict";function r(n){var e=n.env,t=n.data,r=n.outputs,o=n.inputs;n.onError,o.params((function(n,o){var i;e.collect("获取请求头 val: ",null==e?void 0:e.headers),t.headerName?r.rtn(null===(i=null==e?void 0:e.headers)||void 0===i?void 0:i[t.headerName]):r.rtn(null==e?void 0:e.headers)}))}t.d(e,{A:()=>r})},678:(n,e,t)=>{"use strict";function r(n){var e=n.env,t=n.data,r=(n.outputs,n.inputs),o=n.onError;r.params((function(n,r){var i,a,c,u,l;if(!t.appId||!t.appSecret)return o("appID和appSecret是必填项，请检查配置");if(!n||"string"!=typeof n)return o("小程序登录凭证不存在，请检查输入项");try{null===(u=null===(c=null===(a=null===(i=e.services)||void 0===i?void 0:i.wechatMiniapp)||void 0===a?void 0:a.code2Session)||void 0===c?void 0:c.call(a,n,t.appId,t.appSecret))||void 0===u||u.then((function(n){if(null==n?void 0:n.errcode)return o("小程序登录失败[".concat(n.errcode,"]：").concat(n.errmsg));r.rtn(n)}))}catch(n){o("小程序登录调用失败：".concat(null!==(l=null==n?void 0:n.message)&&void 0!==l?l:"未知错误"))}}))}t.d(e,{A:()=>r})}},__webpack_module_cache__={};function __webpack_require__(n){var e=__webpack_module_cache__[n];if(void 0!==e)return e.exports;var t=__webpack_module_cache__[n]={exports:{}};return __webpack_modules__[n](t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(n,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},__webpack_require__.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var __webpack_exports__={};let world="undefined"==typeof window?global:window,comlibRT=world.__comlibs_rt_;comlibRT||(comlibRT=world.__comlibs_rt_=[]);const comAray=[];let comDef;comlibRT.push({id:"@mybricks/comlib-domain-normal",title:"MyBricks领域建模通用组件库",version:"0.0.8",comAray}),comDef={namespace:"mybricks.domain.select",version:"1.0.0",runtime:__webpack_require__(537).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.selectByPager",version:"1.0.0",runtime:__webpack_require__(251).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.singleSelect",version:"1.0.0",runtime:__webpack_require__(737).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.selectCount",version:"1.0.0",runtime:__webpack_require__(88).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.dbInsert",version:"1.0.0",runtime:__webpack_require__(624).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.dbBatchInsert",version:"1.0.0",runtime:__webpack_require__(870).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.dbUpdate",version:"1.0.0",runtime:__webpack_require__(576).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.dbBatchUpdate",version:"1.0.0",runtime:__webpack_require__(314).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.dbDelete",version:"1.0.0",runtime:__webpack_require__(670).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.getAuthUser",version:"1.0.0",runtime:__webpack_require__(564).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.end",version:"1.0.0",runtime:__webpack_require__(755).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.segment",version:"1.0.0",runtime:__webpack_require__(462).A},comAray.push(comDef),comDef={namespace:"mybricks.normal-pc.service",version:"1.0.7",runtime:__webpack_require__(728).A},comAray.push(comDef),comDef={namespace:"mybricks.core-comlib.var",version:"1.0.0",runtime:__webpack_require__(443).A},comAray.push(comDef),comDef={namespace:"mybricks.core-comlib._muilt-inputJs",version:"1.0.0",runtime:__webpack_require__(571).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.requestHeader",version:"1.0.0",runtime:__webpack_require__(513).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.cookie-get",version:"1.0.0",runtime:__webpack_require__(760).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.cookie-set",version:"1.0.0",runtime:__webpack_require__(332).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.jwt-sign",version:"1.0.0",runtime:__webpack_require__(698).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.jwt-verify",version:"1.0.0",runtime:__webpack_require__(74).A},comAray.push(comDef),comDef={namespace:"mybricks.domain.weapp-login",version:"1.0.0",runtime:__webpack_require__(678).A},comAray.push(comDef);var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
//# sourceMappingURL=rt.js.map